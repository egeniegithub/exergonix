$(function() {
    "use strict";
    $(function() {
        $(".preloader").fadeOut()
    }), jQuery(document).on("click", ".mega-dropdown", function(e) {
        e.stopPropagation()
    });
    var e = function() {
        (window.innerWidth > 0 ? window.innerWidth : this.screen.width) < 1170 ? ($("body").addClass("mini-sidebar"), $(".sidebartoggler i").addClass("ti-menu")) : $("body").removeClass("mini-sidebar");
        var e = (window.innerHeight > 0 ? window.innerHeight : this.screen.height) - 1;
        (e -= 190) < 1 && (e = 1), e > 190 && $(".page-wrapper").css("min-height", e + "px")
    };

    function a() {
        $(window).scrollTop() > 80 ? ($("body").addClass("fixed-sidebar"), $(".left-sidebar").addClass("animated slideInDown")) : ($("body").removeClass("fixed-sidebar"), $(".left-sidebar").removeClass("animated slideInDown"))
    }
    $(window).ready(e), $(window).on("resize", e), $(".sidebartoggler").on("click", function() {
        $("body").hasClass("mini-sidebar") ? ($("body").trigger("resize"), $("body").removeClass("mini-sidebar"), $(".navbar-brand span").show()) : ($("body").trigger("resize"), $("body").addClass("mini-sidebar"), $(".navbar-brand span").hide())
    }), $(".nav-toggler").click(function() {
        $("body").toggleClass("show-sidebar"), $(".nav-toggler i").toggleClass("ti-menu"), $(".nav-toggler i").addClass("ti-close")
    }), $(".search-box a, .search-box .app-search .srh-btn").on("click", function() {
        $(".app-search").toggle(200)
    }), $(".right-side-toggle").click(function() {
        $(".right-sidebar").slideDown(50), $(".right-sidebar").toggleClass("shw-rside")
    }), $(".floating-labels .form-control").on("focus blur", function(e) {
        $(this).parents(".form-group").toggleClass("focused", "focus" === e.type || this.value.length > 0)
    }).trigger("blur"), $(function() {
        //$('[data-toggle="tooltip"]').tooltip()
    }), $(function() {
        //$('[data-toggle="popover"]').popover()
    }), $(".right-side-panel, .message-center, .right-sidebar").perfectScrollbar(), $("body").trigger("resize"), $(".list-task li label").click(function() {
        $(this).toggleClass("task-done")
    }), $('a[data-action="collapse"]').on("click", function(e) {
        e.preventDefault(), $(this).closest(".card").find('[data-action="collapse"] i').toggleClass("ti-minus ti-plus"), $(this).closest(".card").children(".card-body").collapse("toggle")
    }), $('a[data-action="expand"]').on("click", function(e) {
        e.preventDefault(), $(this).closest(".card").find('[data-action="expand"] i').toggleClass("mdi-arrow-expand mdi-arrow-compress"), $(this).closest(".card").toggleClass("card-fullscreen")
    }), $('a[data-action="close"]').on("click", function() {
        $(this).closest(".card").removeClass().slideUp("fast")
    }), $(window).scroll(a), a();
    var i, d = ["skin-default", "skin-green", "skin-red", "skin-blue", "skin-purple", "skin-megna", "skin-default-dark", "skin-green-dark", "skin-red-dark", "skin-blue-dark", "skin-purple-dark", "skin-megna-dark"];

    function l(e) {
        var a, i;
        return $.each(d, function(e) {
            $("body").removeClass(d[e])
        }), $("body").addClass(e), a = "skin", i = e, "undefined" != typeof Storage ? localStorage.setItem(a, i) : window.alert("Please use a modern browser to properly view this template!"), !1
    }(i = function(e) {
        if ("undefined" != typeof Storage) return localStorage.getItem("skin");
        window.alert("Please use a modern browser to properly view this template!")
    }()) && $.inArray(i, d) && l(i), $("[data-skin]").on("click", function(e) {
        $(this).hasClass("knob") || (e.preventDefault(), l($(this).data("skin")))
    }), $("#themecolors").on("click", "a", function() {
        $("#themecolors li a").removeClass("working"), $(this).addClass("working")
    })
});
var G = new jsnx.Graph;
G.addWeightedEdgesFrom([
    [2, 3, 10]
]), G.addStar([3, 4, 5, 6, 24, 47, 39], {
    weight: 5
}), G.addStar([2, 1, 0, -1, 84, 97, 39], {
    weight: 3
}), jsnx.draw(G, {
    element: "#canvas",
    weighted: !0,
    edgeStyle: {
        "stroke-width": 10
    }
}), $(document).ready(function() {
    $("#plus_btn").click(function() {
        $("#region_select").slideDown().addClass("region_select"), $(this).hide()
    })
});

$(document).ready(function($) {
    var type = $('.graph-subarea a[data-status="active"]').data('type');

    if (typeof(type) != "undefined") {
        $('#chart_'+type).show();
    }
});

$(document).on('click', '.graph-subarea a', function(event) {
    event.preventDefault();
    var $this = $(this);

    $('.graph-subarea a').attr('data-status', '');
    $this.attr('data-status', 'active');

    var current_type = $this.data('type');
    var current_status = $this.data('status');

    if(current_type == 'state'){
        state_form_init(1);
    } else if(current_type == 'ea') {
        ea_form_init(1);
    } else if(current_type == 'county') {
        county_form_init(1);
    } else if(current_type == 'city') {
        city_form_init(1);
    }
});

function state_form_init(state){
    $(".map_area").hide();
    $("#chart_state").show();
}
function ea_form_init(state){
    $(".map_area").hide();
    $("#chart_ea").show();
}
function county_form_init(state){
    $(".map_area").hide();
    $("#chart_county").show();

}
function city_form_init(state){
    $(".map_area").hide();
    $("#chart_city").show();
}


var fips_data_file = "EA_FIPS.csv";

var map;
var countymap;
var ea_colors = [
  "#fa8072"
  ];

AmCharts.ready(function() {
    map = new AmCharts.AmMap();
    map.hideCredits = !0;
    var wordlDataProvider = {
        mapVar: AmCharts.maps.usaLow,
        getAreasFromMap: true,
        areas: [ 
        {
          id: "US-AL",
          value: 4447100,
          color: '#FCC36C'
        }, {
          id: "US-AK",
          value: 626932,
          color: '#FCC36C'
        }, {
          id: "US-AZ",
          value: 5130632,
          color: '#FCC36C'
        }, {
          id: "US-AR",
          value: 2673400,
          color: '#FCC36C'
        }, {
          id: "US-CA",
          value: 33871648,
          color: '#FCC36C'
        }, {
          id: "US-CO",
          value: 4301261,
          color: '#FCC36C'
        }, {
          id: "US-CT",
          value: 3405565,
          color: '#FCC36C'
        }, {
          id: "US-DE",
          value: 783600,
          color: '#FCC36C'
        }, {
          id: "US-FL",
          value: 15982378,
          color: '#FCC36C'
        }, {
          id: "US-GA",
          value: 8186453,
          color: '#FCC36C'
        }, {
          id: "US-HI",
          value: 1211537,
          color: '#FCC36C'
        }, {
          id: "US-ID",
          value: 1293953,
          color: '#FCC36C'
        }, {
          id: "US-IL",
          value: 12419293,
          color: '#FCC36C'
        }, {
          id: "US-IN",
          value: 6080485,
          color: '#FCC36C'
        }, {
          id: "US-IA",
          value: 2926324,
          color: '#FCC36C'
        }, {
          id: "US-KS",
          value: 2688418,
          color: '#FCC36C'
        }, {
          id: "US-KY",
          value: 4041769,
          color: '#FCC36C'
        }, {
          id: "US-LA",
          value: 4468976,
          color: '#FCC36C'
        }, {
          id: "US-ME",
          value: 1274923,
          color: '#FCC36C'
        }, {
          id: "US-MD",
          value: 5296486,
          color: '#FCC36C'
        }, {
          id: "US-MA",
          value: 6349097,
          color: '#FCC36C'
        }, {
          id: "US-MI",
          value: 9938444,
          color: '#FCC36C'
        }, {
          id: "US-MN",
          value: 4919479,
          color: '#FCC36C'
        }, {
          id: "US-MS",
          value: 2844658,
          color: '#FCC36C'
        }, {
          id: "US-MO",
          value: 5595211,
          color: '#FCC36C'
        }, {
          id: "US-MT",
          value: 902195,
          color: '#FCC36C'
        }, {
          id: "US-NE",
          value: 1711263,
          color: '#FCC36C'
        }, {
          id: "US-NV",
          value: 1998257,
          color: '#FCC36C'
        }, {
          id: "US-NH",
          value: 1235786,
          color: '#FCC36C'
        }, {
          id: "US-NJ",
          value: 8414350,
          color: '#FCC36C'
        }, {
          id: "US-NM",
          value: 1819046,
          color: '#FCC36C'
        }, {
          id: "US-NY",
          value: 18976457,
          color: '#FCC36C'
        }, {
          id: "US-NC",
          value: 8049313,
          color: '#FCC36C'
        }, {
          id: "US-ND",
          value: 642200,
          color: '#FCC36C'
        }, {
          id: "US-OH",
          value: 11353140,
          color: '#FCC36C'
        }, {
          id: "US-OK",
          value: 3450654,
          color: '#FCC36C'
        }, {
          id: "US-OR",
          value: 3421399,
          color: '#FCC36C'
        }, {
          id: "US-PA",
          value: 12281054,
          color: '#FCC36C'
        }, {
          id: "US-RI",
          value: 1048319,
          color: '#FCC36C'
        }, {
          id: "US-SC",
          value: 4012012,
          color: '#FCC36C'
        }, {
          id: "US-SD",
          value: 754844,
          color: '#FCC36C'
        }, {
          id: "US-TN",
          value: 5689283,
          color: '#FCC36C'
        }, {
          id: "US-TX",
          value: 20851820,
          color: '#FCC36C'
        }, {
          id: "US-UT",
          value: 2233169,
          color: '#FCC36C'
        }, {
          id: "US-VT",
          value: 608827,
          color: '#FCC36C'
        }, {
          id: "US-VA",
          value: 7078515,
          color: '#FCC36C'
        }, {
          id: "US-WA",
          value: 5894121,
          color: '#FCC36C'
        }, {
          id: "US-WV",
          value: 1808344,
          color: '#FCC36C'
        }, {
          id: "US-WI",
          value: 5363675,
          color: '#FCC36C'
        }, {
          id: "US-WY",
          value: 493782,
          color: '#FCC36C'
        } ]
    };

    map.imagesSettings = {
      "labelPosition": "middle",
      "labelFontSize": 8
    },

    map.dataProvider = wordlDataProvider;
    map.areasSettings = {
        /*autoZoom: true,
        color: '#03A9F3',
        selectedColor: "#7B7B97",*/

        color: '#FCC36C',
        selectedColor: "#DB5918",
        OutlineColor: "#CC0000",
        selectedOutlineColor: "#CC0000",
        alpha: 0.8,
        selectable: true,
        unlistedAreasAlpha: 0.1,
        selectedOutlineThickness: 5,
        OutlineThickness: 5,
    };
    map.zoomControl = {
      zoomControlEnabled: !1
    };
    
    map.addListener("clickMapObject", function (event) {
      var id = event.mapObject.id;
      var map_id = id.replace("US-", "").toLowerCase();
      var map_type = map_id+'Counties';
      document.getElementById('chart_state').setAttribute('data-type', map_type);
      loadCountyMap(map_id, map_type);
      jQuery('.graph-subarea a[data-type="county"]').click();
    });

    map.write("chart_state");

});

function loadCountyMap(mapName, map_type) {
  
    if (AmCharts.maps[map_type] != undefined) {
        setCountyMap(mapName);
        setCountyEAMap(mapName);
    }
    else {
        var url = window.location.href+'/dist/js/us-counties/js/'+map_type+'.js';
        jQuery.getScript(url, function () {
            setCountyMap(mapName);
            setCountyEAMap(mapName);
        });
    }
}


/*function get_csv_data(){
  d3.csv(fips_data_file).get(function(error, rows) { 
      console.log(rows);
  });
}*/
function setCountyMap(mapName) {
    d3.csv(fips_data_file).get(function(error, rows) { 
      var county_areas = [];
      var county_images = [];
      var k = 0;
      for (var i = 0; i < rows.length; i++) {

        var countyname = rows[i]['countyname'];
        var fips = rows[i]['fips'];
        county_n = countyname.split(", ");
        var data_state_name = county_n[county_n.length - 1];
        data_state_name = data_state_name.toLowerCase();
        if(data_state_name == mapName){
          county_areas.push({'id':fips, 'value':county_n[0]});
          county_images.push({'labelPosition':'center', 'label':county_n[0]+"asdasd"});
        }

        k++;
      }

      var dataProvider = {
          mapVar: AmCharts.maps[mapName+'Counties'],
          getAreasFromMap: true,
          areas: county_areas,
          images: county_images,
      };
      countymap = new AmCharts.AmMap();
      countymap.dataProvider = dataProvider;
      countymap.areasSettings = {
          color: '#E0E0E0',
          selectedColor: "#E0E0E0",
          OutlineColor: "#CC0000",
          selectedOutlineColor: "#CC0000",
          alpha: 0.8,
          selectable: true,
          unlistedAreasAlpha: 0.1,
          selectedOutlineThickness: 5,
          OutlineThickness: 5,
      };
      countymap.hideCredits = !0;
      
      countymap.zoomControl = {
        zoomControlEnabled: !1
      };

      countymap.write("chart_county");
    });
}

function setCountyEAMap(mapName) {

  d3.csv(fips_data_file).get(function(error, data) { 
    var ea_areas = [];
    const ea_groups = {};
    const ea_groups_dddd = [];
    var k = 0;
      for (var i = 0; i < data.length; i++) {
        var countyname = data[i]['countyname'];
        var fips = data[i]['fips'];
        var ea_code = data[i]['ea'];
        var ea_name_o = data[i]['eaname'];
        
        ea_name_o = ea_name_o.split(", ");
        ea_name = ea_name_o[0];
        ea_name = ea_name.toLowerCase().replace(/[^A-Z0-9]/ig, "_");
        county_n = countyname.split(", ");
        var data_state_name = county_n[county_n.length - 1];
        data_state_name = data_state_name.toLowerCase();
        if(data_state_name == mapName){
          ea_areas.push({
            'value':fips,
            'id': 'C'+fips,
            'groupId':ea_code,
            'color':'#E0E0E0',
            'customData': ea_name_o[0],
            'group_title': ea_name_o[0]
          });
        }

        k++;


      }

      var ea_areas_n = d3.nest().key(function(d) { return d.groupId; }).entries(ea_areas);

      for (var i = 0; i < ea_areas_n.length; i++) {
        if(ea_areas_n[i]){
          var color_i = ea_colors[i];
          //console.log(ea_areas_n[i]);
          for (var j = 0; j < ea_areas_n[i].values.length; j++) {
            var l = ea_areas_n[i].values[j];
            //l.color = color_i;
            ea_groups_dddd.push(l);

            //console.log(l);
          }
        }
        
      }

    eamap = new AmCharts.AmMap();
    eamap.dataProvider = {
        mapVar: AmCharts.maps[mapName+'Counties'],
        getAreasFromMap: true,
        areas: ea_groups_dddd,
    };
    eamap.areasSettings = {
        color: '#E0E0E0',
        selectedColor: "#E0E0E0",
        OutlineColor: "#CC0000",
        selectedOutlineColor: "#CC0000",
        alpha: 0.8,
        selectable: true,
        unlistedAreasAlpha: 0.1,
        selectedOutlineThickness: 3,
        OutlineThickness: 3,
        rollOverColor: "#E0E0E0",
        rollOverOutlineColor: "#CC0000",
        balloonText: "[[customData]]"
    };
    eamap.hideCredits = !0;
    
    eamap.zoomControl = {
      zoomControlEnabled: !1
    };

    eamap.write("chart_ea");
  });
}